{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useBkash = void 0;\nconst react_1 = require(\"react\");\nconst utils_1 = require(\"../utils\");\nconst useAsync_1 = require(\"./useAsync\");\nconst BKASH_BUTTON_ID = 'bKash_button';\nconst useBkash = config => {\n  const [componentError, setComponentError] = (0, react_1.useState)(null);\n  const paymentID = (0, react_1.useRef)(null);\n  const createBkashButton = (0, react_1.useCallback)(() => {\n    const button = document.createElement('button');\n    button.style.display = 'none';\n    button.id = BKASH_BUTTON_ID;\n    const body = document.querySelector('body');\n    if (body) {\n      body.appendChild(button);\n      return;\n    }\n  }, []);\n  const initBkash = (0, react_1.useCallback)(() => __awaiter(void 0, void 0, void 0, function* () {\n    createBkashButton();\n    yield (0, utils_1.loadDependencies)(config.bkashScriptURL);\n    const bkashConfig = {\n      paymentMode: 'checkout',\n      paymentRequest: {\n        amount: String(config.amount),\n        intent: 'sale',\n        currency: 'BDT'\n      },\n      createRequest: request => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n          const result = yield config.onCreatePayment(request);\n          paymentID.current = result.paymentID;\n          bKash.create().onSuccess(result);\n        } catch (error) {\n          setComponentError(error);\n          bKash.create().onError();\n        }\n      }),\n      executeRequestOnAuthorization: () => __awaiter(void 0, void 0, void 0, function* () {\n        if (!paymentID.current) {\n          return setComponentError(new Error('No payment ID found'));\n        }\n        try {\n          const result = yield config.onExecutePayment(paymentID.current);\n          config.onSuccess(result);\n        } catch (error) {\n          setComponentError(error);\n          bKash.execute().onError();\n        }\n      }),\n      onClose: config.onClose\n    };\n    if (typeof bKash === 'undefined') {\n      setComponentError(new Error('bKash is not initialized properly, please provide a valid bKash script URL'));\n      return;\n    }\n    bKash.init(bkashConfig);\n  }), [config, createBkashButton]);\n  const triggerBkash = (0, react_1.useCallback)(() => {\n    const createdButton = document.getElementById(BKASH_BUTTON_ID);\n    if (createdButton) {\n      createdButton.click();\n      createdButton.remove();\n      return;\n    }\n    setComponentError(new Error('Could not find bkash button on document'));\n  }, []);\n  const {\n    error,\n    loading\n  } = (0, useAsync_1.useAsync)({\n    fn: initBkash\n  });\n  return {\n    error: error || componentError,\n    loading,\n    triggerBkash\n  };\n};\nexports.useBkash = useBkash;","map":{"version":3,"names":["react_1","require","utils_1","useAsync_1","BKASH_BUTTON_ID","useBkash","config","componentError","setComponentError","useState","paymentID","useRef","createBkashButton","useCallback","button","document","createElement","style","display","id","body","querySelector","appendChild","initBkash","__awaiter","loadDependencies","bkashScriptURL","bkashConfig","paymentMode","paymentRequest","amount","String","intent","currency","createRequest","request","result","onCreatePayment","current","bKash","create","onSuccess","error","onError","executeRequestOnAuthorization","Error","onExecutePayment","execute","onClose","init","triggerBkash","createdButton","getElementById","click","remove","loading","useAsync","fn","exports"],"sources":["../../src/hooks/useBkash.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}